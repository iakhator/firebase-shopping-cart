import{L as z,M as X,n as Z,p as H,N as J,y as m,O as ee,j as v,q as T,P as se,Q as ae,l as te,w as o,_ as le,o as E,a as s,b as l,R as oe,m as t,S as re,T as ne,U as ie,B as de,E as ce,V as ue,W as me,X as pe,Y as fe,c as F,G as _e,t as p,Z as ve,z as ge,d as I,F as ye,s as be,D as Ce,$ as Ne,a0 as he,a1 as Ve,a2 as Ee,x as xe}from"./CJ91jfVQ.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{c as Se}from"./CumM2MxI.js";import{U as Ae}from"./BOVI2s0H.js";import{u as ke}from"./C3Ashe_A.js";import{_ as we}from"./DlAUqK2U.js";const Ue=z("/images/visa.svg"),Pe=z("/images/mastercard.svg"),qe=z("/images/amex.svg"),Fe={class:"checkout"},Ie={class:"checkout-container"},ze={class:"payment-section"},Oe={class:"payment-form"},Be={class:"stripe-container"},Le={class:"stripe-element-container"},Re={key:0,id:"card-errors",class:"stripe-errors"},Me={class:"product-section"},Te={class:"product-content"},De={class:"product-card"},$e={class:"product-image"},Ye=["src"],Ge={class:"product-details"},je={class:"font-medium"},Ke={class:"product-variant text-sm"},Qe={class:"product-price text-sm"},We={class:"price-breakdown"},Xe={class:"price-row"},Ze={class:"price-row discount"},He={class:"price-row"},Je={class:"price-row total"},es={class:"shipping-info"},ss={class:"actions"},as={class:"secure-badge"},D=15,ts={__name:"checkout",setup(ls){const{$stripe:O}=X(),f=Z(),x=H(),{toUSD:g}=ke();J();const i=m({email:"",firstName:"",lastName:"",address:"",city:"",postalCode:"",country:"us"}),$=m(null),Y=ee({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Email is required",trigger:"blur"}],firstName:[{required:!0,message:"First name is required",trigger:"blur"}],lastName:[{required:!0,message:"Last name is required",trigger:"blur"}],address:[{required:!0,message:"Address is required",trigger:"blur"}],city:[{required:!0,message:"City is required",trigger:"blur"}],postalCode:[{required:!1,message:"Please enter your postal code",trigger:"blur"}]});m(null);const B=m(null),y=m(null),S=m(null),A=m(null),k=m(""),b=m(!1),C=m(!1);m(1),v(()=>f.isAuthenticated);const L=v(()=>x.cart),w=v(()=>x.totalPrice),R=v(()=>Math.round(w.value*.05)),U=v(()=>w.value+D-R.value),P=v(()=>{var a;return((a=f.user)==null?void 0:a.firstName)||""}),q=v(()=>{var a;return((a=f.user)==null?void 0:a.lastName)||""});T(async()=>{const a=f.user;i.value={firstName:P.value,lastName:q.value,email:(a==null?void 0:a.email)||"",address:(a==null?void 0:a.shippingAddress.address)||"",street:(a==null?void 0:a.shippingAddress.street)||"",city:(a==null?void 0:a.shippingAddress.city)||"",country:(a==null?void 0:a.shippingAddress.country)||"",postalCode:(a==null?void 0:a.shippingAddress.postalCode)||""}}),T(()=>{se(()=>{try{const e={base:{color:"#1b1a1a",fontFamily:"inherit","::placeholder":{color:"#acafb7"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}};B.value=O.elements();const r=(d,_,N)=>{const c=B.value.create(d,{style:e,placeholder:N});return c.mount(`#${_}`),c.on("focus",()=>{var u;return(u=document.getElementById(_))==null?void 0:u.classList.add("focused")}),c.on("blur",()=>{var u;return(u=document.getElementById(_))==null?void 0:u.classList.remove("focused")}),c.on("change",u=>{var h;k.value=((h=u.error)==null?void 0:h.message)||""}),c};y.value=r("cardNumber","card-number-element","1234 5678 9012 3456"),S.value=r("cardExpiry","card-expiry-element","MM/YY"),A.value=r("cardCvc","card-cvc-element","123")}catch(e){console.error("Error mounting Stripe elements:",e)}});const a=f.user;i.value={firstName:P.value,lastName:q.value,email:(a==null?void 0:a.email)||"",address:(a==null?void 0:a.shippingAddress.address)||"",street:(a==null?void 0:a.shippingAddress.street)||"",city:(a==null?void 0:a.shippingAddress.city)||"",country:(a==null?void 0:a.shippingAddress.country)||"",postalCode:(a==null?void 0:a.shippingAddress.postalCode)||""}}),ae(()=>{y.value&&y.value.unmount(),S.value&&S.value.unmount(),A.value&&A.value.unmount()});const G=async()=>{b.value=!0;const a=L.value.map(r=>{var d;return{id:r.productId,quantity:r.quantity,name:r.name,price:r.price,originalPrice:r.originalPrice,variant:((d=r.variant)==null?void 0:d.color)||"",bundle:r.bundle||""}}),e={customerName:f.user.displayName,userId:f.user.uid,shippingAddress:f.user.shippingAddress,savePaymentMethod:C.value,amount:U.value,items:a};try{const r=await $fetch("/api/payment/process-payment",{method:"POST",body:e}),d=r.clientSecret;if(!d)throw new Error("Failed to retrieve client secret from payment intent");(await O.confirmCardPayment(d,{payment_method:{card:y.value}})).paymentIntent.status==="succeeded"&&r.orderId&&(await x.clearCart(),await xe(`/orders/success?ref=${r.orderId}`))}catch(r){console.log(r),b.value=!1}finally{b.value=!1}};return(a,e)=>{const r=de,d=ie,_=ne,N=re,c=ce,u=fe,h=pe,j=ve,K=oe,Q=Ce,W=le;return E(),te(W,null,{default:o(()=>[s("div",Fe,[e[22]||(e[22]=s("h2",{class:"font-briscolade"},"Checkout",-1)),s("div",Ie,[s("div",ze,[s("div",Oe,[e[14]||(e[14]=s("h3",{class:"section-title font-briscolade"}," Contact Information ",-1)),l(K,{model:t(i),rules:t(Y),ref_key:"ruleFormRef",ref:$,"label-position":"top"},{default:o(()=>[l(N,{gutter:12},{default:o(()=>[l(_,{span:12},{default:o(()=>[l(d,{label:"First Name",prop:"firstName",class:"custom-select"},{default:o(()=>[l(r,{modelValue:t(i).firstName,"onUpdate:modelValue":e[0]||(e[0]=n=>t(i).firstName=n),placeholder:"First Name",value:t(P),size:"large"},null,8,["modelValue","value"])]),_:1})]),_:1}),l(_,{span:12},{default:o(()=>[l(d,{label:"Last Name",prop:"lastName"},{default:o(()=>[l(r,{modelValue:t(i).lastName,"onUpdate:modelValue":e[1]||(e[1]=n=>t(i).lastName=n),placeholder:"Last Name",size:"large",value:t(q)},null,8,["modelValue","value"])]),_:1})]),_:1})]),_:1}),l(d,{label:"Email",prop:"email"},{default:o(()=>{var n;return[l(r,{modelValue:t(i).email,"onUpdate:modelValue":e[2]||(e[2]=V=>t(i).email=V),value:(n=t(f).user)==null?void 0:n.email,placeholder:"your@email.com",size:"large"},{prefix:o(()=>[l(c,null,{default:o(()=>[l(t(ue))]),_:1})]),_:1},8,["modelValue","value"])]}),_:1}),e[13]||(e[13]=s("h3",{class:"section-title font-briscolade"}," Shipping Address ",-1)),l(d,{label:"Address",prop:"address"},{default:o(()=>[l(r,{modelValue:t(i).address,"onUpdate:modelValue":e[3]||(e[3]=n=>t(i).address=n),placeholder:"Street Address",size:"large"},{prefix:o(()=>[l(c,null,{default:o(()=>[l(t(me))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(N,{gutter:12},{default:o(()=>[l(_,{span:12},{default:o(()=>[l(d,{label:"City",prop:"city"},{default:o(()=>[l(r,{modelValue:t(i).city,"onUpdate:modelValue":e[4]||(e[4]=n=>t(i).city=n),placeholder:"City",size:"large"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:o(()=>[l(d,{label:"Postal Code"},{default:o(()=>[l(r,{modelValue:t(i).postalCode,"onUpdate:modelValue":e[5]||(e[5]=n=>t(i).postalCode=n),placeholder:"Postal Code",size:"large"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(d,{label:"Country",class:"custom-select"},{default:o(()=>[l(h,{modelValue:t(i).country,"onUpdate:modelValue":e[6]||(e[6]=n=>t(i).country=n),placeholder:"Select Country",style:{width:"100%"},size:"large"},{default:o(()=>[l(u,{label:"United States",value:"us"}),l(u,{label:"Canada",value:"ca"}),l(u,{label:"Nigeria",value:"na"}),l(u,{label:"United Kingdom",value:"uk"})]),_:1},8,["modelValue"])]),_:1}),s("div",Be,[e[11]||(e[11]=s("h3",{class:"section-title font-briscolade"}," Card Information ",-1)),s("div",Le,[e[8]||(e[8]=s("div",{class:"card-field"},[s("label",{id:"card-number-label"},"Card Number"),s("div",{id:"card-number-element",class:"stripe-element","aria-labelledby":"card-number-label"})],-1)),e[9]||(e[9]=s("div",{class:"card-row"},[s("div",{class:"card-field expiry"},[s("label",{id:"card-expiry-label"},"Expiry Date"),s("div",{id:"card-expiry-element",class:"stripe-element","aria-labelledby":"card-expiry-label"})]),s("div",{class:"card-field cvc"},[s("label",{id:"card-cvc-label"},"CVC"),s("div",{id:"card-cvc-element","aria-labelledby":"card-cvc-label",class:"stripe-element"})])],-1)),t(k)?(E(),F("div",Re,p(t(k)),1)):_e("",!0)]),e[12]||(e[12]=s("div",{class:"card-icons"},[s("img",{src:Ue,alt:"Visa",class:"card-icon"}),s("img",{src:Pe,alt:"Mastercard",class:"card-icon"}),s("img",{src:qe,alt:"American Express",class:"card-icon"})],-1)),l(j,{modelValue:t(C),"onUpdate:modelValue":e[7]||(e[7]=n=>ge(C)?C.value=n:null)},{default:o(()=>e[10]||(e[10]=[I("Save card for future purchases")])),_:1,__:[10]},8,["modelValue"])])]),_:1,__:[13]},8,["model","rules"])])]),s("div",Me,[s("div",Te,[e[21]||(e[21]=s("h2",{class:"product-order-summary font-briscolade"}," Order Summary ",-1)),(E(!0),F(ye,null,be(t(L),n=>{var V,M;return E(),F("div",De,[s("div",$e,[s("img",{src:(V=n.variant)==null?void 0:V.imageUrl,alt:"OnePlus 12 Dual 5G"},null,8,Ye)]),s("div",Ge,[s("h3",je,p(n.name),1),s("p",Ke,p(("capitalize"in a?a.capitalize:t(Se))((M=n.variant)==null?void 0:M.color))+", "+p(n.bundle),1),s("div",Qe,p(t(g)(n.price))+" x "+p(n.quantity),1)])])}),256)),s("div",We,[s("div",Xe,[e[15]||(e[15]=s("span",null,"Subtotal",-1)),s("span",null,p(t(g)(t(w))),1)]),s("div",Ze,[s("span",null,[l(Q,{size:"small",effect:"dark",type:"success"},{default:o(()=>[l(c,null,{default:o(()=>[l(t(Ne))]),_:1}),e[16]||(e[16]=I(" 15% OFF "))]),_:1,__:[16]})]),s("span",null," - "+p(t(g)(t(R))),1)]),s("div",He,[e[17]||(e[17]=s("span",null,"Shipping",-1)),s("span",null,p(t(g)(D)),1)]),s("div",Je,[e[18]||(e[18]=s("span",null,"Total",-1)),s("span",null,p(t(g)(t(U))),1)])]),s("div",es,[l(c,null,{default:o(()=>[l(t(he))]),_:1}),e[19]||(e[19]=s("span",null,"Estimated delivery: 3-5 business days",-1))]),s("div",ss,[l(Ae,{variant:"mild",onClick:G,loading:t(b),size:"large",label:"Place Order"},{icon:o(()=>[l(c,{class:"el-icon--left"},{default:o(()=>[l(t(Ve))]),_:1})]),default:o(()=>[I(" Place Order "+p(t(g)(t(U))),1)]),_:1},8,["loading"])]),s("div",as,[l(c,null,{default:o(()=>[l(t(Ee))]),_:1}),e[20]||(e[20]=s("span",null,"Secure Checkout",-1))])])])])])]),_:1})}}},gs=we(ts,[["__scopeId","data-v-6e631551"]]);export{gs as default};
