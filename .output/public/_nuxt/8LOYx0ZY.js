import{a9 as U,r as u,j as E,G as F,c as n,a as d,v as p,t as _,s as M,b as h,I as k,J as N,aa as j,o as i,ab as C,y as K,n as O,a3 as b}from"./D9U9Eznd.js";/* empty css        *//* empty css        */import{U as D}from"./0wCB_tQN.js";import{_ as R}from"./DlAUqK2U.js";const z={class:"verify-container"},A={class:"verify-card"},G={key:0,class:"verify-error"},J={key:1,class:"verify-success"},L={class:"pin-input-group"},W={key:0,class:"pin-dash"},q={__name:"[code]",setup(H){const I=U();j();const c=I.params.code,a=u(["","","","","",""]),l=u([]),o=u(""),v=u(""),f=u(!1),g=u(""),{$toast:T,$auth:V,$signInWithCustomToken:w}=E();F(async()=>{if(!c||typeof c!="string"||c.length<16){o.value="Invalid or missing verification code.";return}try{const e=await $fetch("/api/verify/validate-code",{method:"POST",body:{code:c}});if(!e.success&&e.message){T.info(e.message);return}g.value=e.userId}catch{o.value="Unable to validate verification link."}});function P(e){const t=a.value[e];t.length>1&&(a.value[e]=t.slice(-1)),t&&e<5&&b(()=>{l.value[e+1]&&l.value[e+1].focus()})}function $(e,t){!a.value[e]&&e>0&&b(()=>{l.value[e-1]&&l.value[e-1].focus()})}function B(e){a.value[e]=""}async function S(){o.value="",v.value="",f.value=!0;const e=a.value.join("");try{const t=await $fetch("/api/verify/pin",{method:"POST",body:{code:c,userId:g.value,enteredPin:e}}),m=t.customToken;if(t.success){const y=await w(V,m),s=await y.user.getIdToken(),r=y.user.refreshToken;await $fetch("/api/auth/session",{method:"POST",body:{idToken:s,refreshToken:r}}),O("/")}else o.value=t.message||"Verification failed."}catch(t){console.log(t,"err"),o.value="Verification failed. Please try again."}f.value=!1}return(e,t)=>{const m=K;return i(),n("div",z,[d("div",A,[t[0]||(t[0]=d("h2",{class:"verify-title briscolade"},"Email Verification",-1)),t[1]||(t[1]=d("p",{class:"verify-desc mb-4"}," Please enter the 6-digit code sent to your email to verify your account. ",-1)),o.value?(i(),n("div",G,_(o.value),1)):p("",!0),v.value?(i(),n("div",J,_(v.value),1)):p("",!0),v.value?p("",!0):(i(),n("form",{key:2,onSubmit:M(S,["prevent"])},[d("div",L,[(i(!0),n(k,null,N(a.value,(y,s)=>(i(),n(k,{key:s},[h(m,{ref_for:!0,ref_key:"elPinInputs",ref:l,modelValue:a.value[s],"onUpdate:modelValue":r=>a.value[s]=r,maxlength:"1",inputmode:"numeric",type:"text",class:"pin-input",onInput:r=>P(s),onKeydown:C(r=>$(s),["backspace"]),onFocus:r=>B(s),autofocus:s===0,style:{width:"2.5rem",margin:"0 0.25rem","text-align":"center"}},null,8,["modelValue","onUpdate:modelValue","onInput","onKeydown","onFocus","autofocus"]),s<5?(i(),n("span",W,"-")):p("",!0)],64))),128))]),h(D,{label:"Verify Email",size:"large",class:"primary","native-type":"submit",loading:f.value,disabled:f.value||a.value.join("").length!==6},null,8,["loading","disabled"])],32))])])}}},ee=R(q,[["__scopeId","data-v-368c1607"]]);export{ee as default};
