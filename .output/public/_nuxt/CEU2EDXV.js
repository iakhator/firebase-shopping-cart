import{a2 as M,j as W,i as Z,F as ee,r as v,k as ae,e as C,G as le,a3 as te,l as se,g as oe,w as s,o as P,a,b as l,M as re,N as ne,d as V,q as de,h as t,a0 as ie,a1 as ue,x as ce,y as me,p as pe,z as fe,X as _e,Y as ve,a4 as ge,a5 as be,c as L,v as ye,t as f,B as he,a6 as Ce,I as Ne,J as Ve,a7 as Ee,a8 as xe,T as Se,L as ke,A as we,n as Pe}from"./D9U9Eznd.js";import{_ as Ie}from"./C9nHfGjo.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{a as Ue}from"./DaiQXbFw.js";import{U as Ae}from"./0wCB_tQN.js";import{u as ze}from"./C3Ashe_A.js";import{_ as Fe}from"./DlAUqK2U.js";const qe=M("/images/visa.svg"),Be=M("/images/mastercard.svg"),Le=M("/images/amex.svg"),Me={class:"checkout"},Oe={class:"checkout-container"},Te={class:"payment-section"},Re={class:"payment-form"},De={class:"stripe-container"},$e={class:"stripe-element-container"},Ye={key:0,id:"card-errors",class:"stripe-errors"},Ge={class:"product-section"},je={class:"product-content"},He={class:"product-card"},Je={class:"product-image"},Ke=["src"],Xe={class:"product-details"},Qe={class:"font-medium"},We={class:"product-variant text-sm"},Ze={class:"product-price text-sm"},ea={class:"price-breakdown"},aa={class:"price-row"},la={class:"price-row discount"},ta={class:"price-row"},sa={class:"price-row total"},oa={class:"shipping-info"},ra={class:"actions"},na={class:"secure-badge"},H=15,da={__name:"checkout",setup(ia){const{$stripe:O}=W(),_=Z(),I=ee(),{toUSD:N}=ze(),n=v({email:"",phone:"",firstName:"",lastName:"",address:"",city:"",postalCode:"",country:"us"}),U=v(null),J=ae({email:[{required:!0,message:"Please enter your email",trigger:"blur"},{type:"email",message:"Email is required",trigger:"blur"}],phone:[{validator:(o,e,c)=>{e?Number.isInteger(e)?c():c(new Error("Phone must be a number")):c(new Error("Phone number is required"))},trigger:"blur"}],firstName:[{required:!0,message:"First name is required",trigger:"blur"}],lastName:[{required:!0,message:"Last name is required",trigger:"blur"}],address:[{required:!0,message:"Address is required",trigger:"blur"}],city:[{required:!0,message:"City is required",trigger:"blur"}],postalCode:[{required:!1,message:"Please enter your postal code",trigger:"blur"}]});v(null);const T=v(null),E=v(null),A=v(null),z=v(null),F=v(""),x=v(!1),S=v(!1);C(()=>_.isAuthenticated);const R=C(()=>I.cart),q=C(()=>I.totalPrice),D=C(()=>Math.round(q.value*.05)),B=C(()=>q.value+H-D.value),$=C(()=>{var o;return((o=_.user)==null?void 0:o.firstName)||""}),Y=C(()=>{var o;return((o=_.user)==null?void 0:o.lastName)||""});let G=!1;le(()=>{var e,c,b,m;G||(G=!0,te(()=>{try{const i={base:{color:"#1b1a1a",fontFamily:"inherit","::placeholder":{color:"#acafb7"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}};T.value=O.elements();const d=(p,u,y)=>{const h=T.value.create(p,{style:i,placeholder:y});return h.mount(`#${u}`),h.on("focus",()=>{var g;return(g=document.getElementById(u))==null?void 0:g.classList.add("focused")}),h.on("blur",()=>{var g;return(g=document.getElementById(u))==null?void 0:g.classList.remove("focused")}),h.on("change",g=>{var k;F.value=((k=g.error)==null?void 0:k.message)||""}),h};E.value=d("cardNumber","card-number-element","1234 5678 9012 3456"),A.value=d("cardExpiry","card-expiry-element","MM/YY"),z.value=d("cardCvc","card-cvc-element","123")}catch(i){console.error("Error mounting Stripe elements:",i)}}));const o=_.user;n.value={firstName:$.value,lastName:Y.value,email:(o==null?void 0:o.email)||"",phone:(o==null?void 0:o.phone)||"",address:((e=o==null?void 0:o.shippingAddress)==null?void 0:e.address)||"",city:((c=o==null?void 0:o.shippingAddress)==null?void 0:c.city)||"",country:((b=o==null?void 0:o.shippingAddress)==null?void 0:b.country)||"",postalCode:((m=o==null?void 0:o.shippingAddress)==null?void 0:m.postalCode)||""}}),se(()=>{E.value&&E.value.unmount(),A.value&&A.value.unmount(),z.value&&z.value.unmount()});const K=async()=>{var c,b,m,i;if(!U.value)return;const o=R.value.map(d=>{var p;return{...d,id:d.productId,variant:((p=d.variant)==null?void 0:p.color)||""}}),e={customerName:_.user.displayName,userId:_.user.uid,email:_.user.email,phone:_.user.phone||"",shippingAddress:_.user.shippingAddress||{address:((c=n.value)==null?void 0:c.address)||"",city:((b=n.value)==null?void 0:b.city)||"",country:((m=n.value)==null?void 0:m.country)||"",postalCode:((i=n.value)==null?void 0:i.postalCode)||""},savePaymentMethod:S.value,amount:B.value,items:o};try{if(!await U.value.validate())return;x.value=!0;const p=await $fetch("/api/payment/process-payment",{method:"POST",body:e}),u=p.clientSecret;if(!u)throw new Error("Failed to retrieve client secret from payment intent");(await O.confirmCardPayment(u,{payment_method:{card:E.value}})).paymentIntent.status==="succeeded"&&p.orderId&&(await I.clearCart(),await Pe(`/orders/success?ref=${p.orderId}`))}catch(d){console.log(d),x.value=!1}finally{x.value=!1}};return(o,e)=>{const c=ne,b=re,m=me,i=ce,d=ue,p=ie,u=pe,y=be,h=ge,g=he,k=de,X=Ee,Q=Ie;return P(),oe(Q,null,{default:s(()=>[a("div",Me,[l(b,{separator:"/",class:"mb-4"},{default:s(()=>[l(c,{to:"/"},{default:s(()=>e[9]||(e[9]=[V("Home")])),_:1,__:[9]}),l(c,null,{default:s(()=>e[10]||(e[10]=[V("Profile")])),_:1,__:[10]}),l(c,null,{default:s(()=>e[11]||(e[11]=[V("Preferences")])),_:1,__:[11]})]),_:1}),e[26]||(e[26]=a("h2",{class:"font-briscolade"},"Checkout",-1)),a("div",Oe,[a("div",Te,[a("div",Re,[e[18]||(e[18]=a("h3",{class:"section-title font-briscolade"}," Contact Information ",-1)),l(k,{model:t(n),rules:t(J),ref_key:"ruleFormRef",ref:U,"label-position":"top"},{default:s(()=>[l(p,{gutter:12},{default:s(()=>[l(d,{span:12},{default:s(()=>[l(i,{label:"First Name",prop:"firstName",class:"custom-select"},{default:s(()=>[l(m,{modelValue:t(n).firstName,"onUpdate:modelValue":e[0]||(e[0]=r=>t(n).firstName=r),placeholder:"First Name",value:t($),size:"large"},null,8,["modelValue","value"])]),_:1})]),_:1}),l(d,{span:12},{default:s(()=>[l(i,{label:"Last Name",prop:"lastName"},{default:s(()=>[l(m,{modelValue:t(n).lastName,"onUpdate:modelValue":e[1]||(e[1]=r=>t(n).lastName=r),placeholder:"Last Name",size:"large",value:t(Y)},null,8,["modelValue","value"])]),_:1})]),_:1})]),_:1}),l(p,{gutter:12},{default:s(()=>[l(d,{span:12},{default:s(()=>[l(i,{label:"Email",prop:"email"},{default:s(()=>{var r;return[l(m,{modelValue:t(n).email,"onUpdate:modelValue":e[2]||(e[2]=w=>t(n).email=w),value:(r=t(_).user)==null?void 0:r.email,placeholder:"your@email.com",size:"large"},{prefix:s(()=>[l(u,null,{default:s(()=>[l(t(fe))]),_:1})]),_:1},8,["modelValue","value"])]}),_:1})]),_:1}),l(d,{span:12},{default:s(()=>[l(i,{label:"Phone",prop:"phone"},{default:s(()=>[l(m,{modelValue:t(n).phone,"onUpdate:modelValue":e[3]||(e[3]=r=>t(n).phone=r),modelModifiers:{number:!0},placeholder:"1234567890",size:"large"},{prefix:s(()=>[l(u,null,{default:s(()=>[l(t(_e))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e[17]||(e[17]=a("h3",{class:"section-title font-briscolade"}," Shipping Address ",-1)),l(i,{label:"Address",prop:"address"},{default:s(()=>[l(m,{modelValue:t(n).address,"onUpdate:modelValue":e[4]||(e[4]=r=>t(n).address=r),placeholder:"Street Address",size:"large"},{prefix:s(()=>[l(u,null,{default:s(()=>[l(t(ve))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(p,{gutter:12},{default:s(()=>[l(d,{span:12},{default:s(()=>[l(i,{label:"City",prop:"city"},{default:s(()=>[l(m,{modelValue:t(n).city,"onUpdate:modelValue":e[5]||(e[5]=r=>t(n).city=r),placeholder:"City",size:"large"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:s(()=>[l(i,{label:"Postal Code"},{default:s(()=>[l(m,{modelValue:t(n).postalCode,"onUpdate:modelValue":e[6]||(e[6]=r=>t(n).postalCode=r),placeholder:"Postal Code",size:"large"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"Country",class:"custom-select"},{default:s(()=>[l(h,{modelValue:t(n).country,"onUpdate:modelValue":e[7]||(e[7]=r=>t(n).country=r),placeholder:"Select Country",style:{width:"100%"},size:"large"},{default:s(()=>[l(y,{label:"United States",value:"us"}),l(y,{label:"Canada",value:"ca"}),l(y,{label:"Nigeria",value:"na"}),l(y,{label:"United Kingdom",value:"uk"})]),_:1},8,["modelValue"])]),_:1}),a("div",De,[e[15]||(e[15]=a("h3",{class:"section-title font-briscolade"}," Card Information ",-1)),a("div",$e,[e[12]||(e[12]=a("div",{class:"card-field"},[a("label",{id:"card-number-label"},"Card Number"),a("div",{id:"card-number-element",class:"stripe-element","aria-labelledby":"card-number-label"})],-1)),e[13]||(e[13]=a("div",{class:"card-row"},[a("div",{class:"card-field expiry"},[a("label",{id:"card-expiry-label"},"Expiry Date"),a("div",{id:"card-expiry-element",class:"stripe-element","aria-labelledby":"card-expiry-label"})]),a("div",{class:"card-field cvc"},[a("label",{id:"card-cvc-label"},"CVC"),a("div",{id:"card-cvc-element","aria-labelledby":"card-cvc-label",class:"stripe-element"})])],-1)),t(F)?(P(),L("div",Ye,f(t(F)),1)):ye("",!0)]),e[16]||(e[16]=a("div",{class:"card-icons"},[a("img",{src:qe,alt:"Visa",class:"card-icon"}),a("img",{src:Be,alt:"Mastercard",class:"card-icon"}),a("img",{src:Le,alt:"American Express",class:"card-icon"})],-1)),l(g,{modelValue:t(S),"onUpdate:modelValue":e[8]||(e[8]=r=>Ce(S)?S.value=r:null)},{default:s(()=>e[14]||(e[14]=[V("Save card for future purchases")])),_:1,__:[14]},8,["modelValue"])])]),_:1,__:[17]},8,["model","rules"])])]),a("div",Ge,[a("div",je,[e[25]||(e[25]=a("h2",{class:"product-order-summary font-briscolade"}," Order Summary ",-1)),(P(!0),L(Ne,null,Ve(t(R),r=>{var w,j;return P(),L("div",He,[a("div",Je,[a("img",{src:(w=r.variant)==null?void 0:w.imageUrl,alt:"OnePlus 12 Dual 5G"},null,8,Ke)]),a("div",Xe,[a("h3",Qe,f(r.name),1),a("p",We,f(("capitalize"in o?o.capitalize:t(Ue))((j=r.variant)==null?void 0:j.color))+", "+f(r.bundle),1),a("div",Ze,f(t(N)(r.price))+" x "+f(r.quantity),1)])])}),256)),a("div",ea,[a("div",aa,[e[19]||(e[19]=a("span",null,"Subtotal",-1)),a("span",null,f(t(N)(t(q))),1)]),a("div",la,[a("span",null,[l(X,{size:"small",effect:"dark",type:"success"},{default:s(()=>[l(u,null,{default:s(()=>[l(t(xe))]),_:1}),e[20]||(e[20]=V(" 15% OFF "))]),_:1,__:[20]})]),a("span",null," - "+f(t(N)(t(D))),1)]),a("div",ta,[e[21]||(e[21]=a("span",null,"Shipping",-1)),a("span",null,f(t(N)(H)),1)]),a("div",sa,[e[22]||(e[22]=a("span",null,"Total",-1)),a("span",null,f(t(N)(t(B))),1)])]),a("div",oa,[l(u,null,{default:s(()=>[l(t(Se))]),_:1}),e[23]||(e[23]=a("span",null,"Estimated delivery: 3-5 business days",-1))]),a("div",ra,[l(Ae,{variant:"mild",onClick:K,loading:t(x),size:"large",label:"Place Order"},{icon:s(()=>[l(u,{class:"el-icon--left"},{default:s(()=>[l(t(ke))]),_:1})]),default:s(()=>[V(" Place Order "+f(t(N)(t(B))),1)]),_:1},8,["loading"])]),a("div",na,[l(u,null,{default:s(()=>[l(t(we))]),_:1}),e[24]||(e[24]=a("span",null,"Secure Checkout",-1))])])])])])]),_:1})}}},xa=Fe(da,[["__scopeId","data-v-2c348e69"]]);export{xa as default};
